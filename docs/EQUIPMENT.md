## CozyNSM Recommended Equipment and Methodology

This is a high-level view of the equipment and infrastructure that are recommended to be used with CozyNSM. In addition, this outlines a methodology of how the equipment should be utilized during an incident response scenario. This is not a hard-and-fast equipment list or methodology, your mileage may vary. For example, this entire stack could be virtualized for training purposes, or expanded to run on many pieces of physical equipment to support a large-scale operation.

1. Customer Network. The cloud represents the location(s) in which you are going to collect traffic (tap) on a customer network. This will likely be an edge router, or a location(s) in the network where traffic of interest will pass. There are a few methods to tapping a network. One method is to configure a [mirror port](https://en.wikipedia.org/wiki/Port_mirroring), which will duplicate traffic on specified ports to the mirrored port. (Note: Although SPAN is specific to Cisco devices, it's commonly used in the industry to refer to port mirroring in general.) Another method would be to physically break a connection and place your network tap between two devices. This could be advantageous in a scenario where a configuration change on a network device (creation of a mirror port) could alert a sophisticated attacker OR in the case that the mirror port would not be capable of handling the combine load across the ports of interest. Lastly, a [vampire tap](https://en.wikipedia.org/wiki/Vampire_tap) could be used which would be similar to the previous method.

2. [Network tap](https://en.wikipedia.org/wiki/Network_tap). This is a crucial device that allows for monitoring data flowing across collection point(s) in a secure and safe manner. Network taps are not detectable on a network (having no physical or logical address), and most are designed to fail-open which means they will continue to pass traffic even if the tap fails or loses power. Many network taps are designed to be "passive" which ensures that traffic coming out of the tap only flows in one direction. It's highly recommended with CozyNSM to use a network tap that will fail-open and is fully passive. Common network taps can be bought from [Gigamon](https://www.gigamon.com/products/g-tap-a-series) or [Datacom](http://datacomsystems.com/products/network-taps). If you're going to be collecting on an enterprise network it's highly recommended to use a network tap that has several modules for collecting on various different types of transmission mediums (GbE, 10GE, SMF, MMF). This is extremely useful for aggregating traffic from multiple locations of interest on a network, it's common for fiber to be used at the edge router and Gigabit Ethernet to be used for internal networks.

3. Sensor. This is a server that will be collecting full-packet capture, gathering traffic metadata, and conducting signature-based intrusion detection. It's recommended that this server have a CPU with at least 4 physical cores and 16GB of RAM. Storage requirement will be based on need, full-packet collection on an enterprise network over several weeks may require tens of terabytes. A healthy CozyNSM sensor for use on an enterprise network might have a 12 core processor, 64 GB of RAM, and 16 TB of storage. The sensor will also need a network interface card that is appropriate for your collection requirement. Note that full-packet collection done by Google Stenographer currently can only support one 10GE NIC, however (as detailed above) many collection points and mediums can be aggregated together by a network tap with additional modules. It's worth mentioning that if you're collecting with a 10GE interface on a highly congested network, there may be write speed limitations on the server (due to full-packet capture) in a RAID5 configuration with HDD's. It's currently recommended to use RAID0 if you're going to collect on a 10GE interface with heavy traffic, unless you are using solid state storage. CentOS 7 (build 1511) or RHEL 7 will need to be installed on the metal before running the deployment script.

4. Application Server. This is an analysis server that will be running many Docker containers for a metadata storage, visualization, internal DNS/NTP/SSO, a git/wiki service, chat service, and other team services. Recommended specifications are similar to that of the sensor, however a large storage requirement is not necessary. CentOS 7 (build 1511) or RHEL 7 will need to be installed on the server before running the deployment script. A local IP schema will need to be decided upon as the sensor, docker containers, and the analyst laptops will all be networked together.

5. Network Switch. A networking device of some sort will be required to connect analysts with the Application server to utilize CozyNSM. A network switch, layer 3 switch, or router could be used.

6. Analyst Laptop. An analyst computer will be needed to utilize the various CozyNSM services. At minimum this computer will need a web browser, an Openfire chat client, and a SSH client. See [here](LAPTOP.md) for a detailed guide of the recommended software to be used to get the most of CozyNSM.
